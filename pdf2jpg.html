<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PDF to JPEG</title>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
<script>
  pdfjsLib.GlobalWorkerOptions.workerSrc =
    "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.worker.min.js";
</script>

<!-- JSZip -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
  body {
    font-family: Arial, sans-serif;
    background:#f9f9f9;
    margin:40px;
  }
  .container {
    max-width:900px;
    margin:auto;
    background:white;
    padding:30px;
    border-radius:8px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
  }
  h1 {
    text-align:center;
    margin-bottom:30px;
  }
  input, select {
    width:100%;
    padding:10px;
    margin:10px 0 20px;
  }
  progress {
    width:100%;
    height:20px;
    display:none;
    margin-top:10px;
  }
  #zip-download {
    display:none;
    margin:20px 0;
    background:#28a745;
    padding:15px;
    color:white;
    text-align:center;
    border-radius:4px;
    text-decoration:none;
  }
  #zip-download:hover {
    background:#1f7f36;
  }
  .thumb-grid {
    display:flex;
    flex-wrap:wrap;
    gap:16px;
    margin-top:20px;
  }
  .thumb-card {
    width:150px;
    background:#f5f5f5;
    border-radius:8px;
    box-shadow:0 1px 3px rgba(0,0,0,0.15);
    padding:8px;
    text-align:center;
    text-decoration:none;
    color:#333;
    display:flex;
    flex-direction:column;
    align-items:center;
    cursor:pointer;
  }
  .thumb-card:hover {
    box-shadow:0 2px 6px rgba(0,0,0,0.2);
    transform:translateY(-1px);
  }
  .thumb-img {
    width:100%;
    max-height:180px;
    object-fit:contain;
    border-radius:4px;
    background:white;
  }
  .thumb-name {
    margin-top:6px;
    font-size:12px;
    word-break:break-word;
  }
</style>
</head>
<body>

<div class="container">
  <h1>PDF → JPEG</h1>

  <input type="file" id="pdf-upload" accept="application/pdf">

  <label>Quality:</label>
  <select id="quality">
    <option value="0.75">Regular</option>
    <option value="0.95">High</option>
  </select>

  <progress id="progress-bar" value="0" max="100"></progress>

  <a id="zip-download">Download All Pages (ZIP)</a>

  <div id="outputs" class="thumb-grid"></div>
</div>

<script>
const pdfUpload   = document.getElementById("pdf-upload");
const qualitySel  = document.getElementById("quality");
const progressBar = document.getElementById("progress-bar");
const outputsDiv  = document.getElementById("outputs");
const zipDownload = document.getElementById("zip-download");

// canvas → JPEG blob
function canvasToBlob(canvas, quality) {
  return new Promise(res => canvas.toBlob(res, "image/jpeg", quality));
}

pdfUpload.addEventListener("change", async () => {
  const file = pdfUpload.files[0];
  if (!file) return;

  outputsDiv.innerHTML = "";
  zipDownload.style.display = "none";

  const arrayBuffer = await file.arrayBuffer();
  const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
  const pageCount = pdf.numPages;

  const quality = Number(qualitySel.value);
  const scale = 1.7;
  const useZip = pageCount > 5;
  const zip = useZip ? new JSZip() : null;
  const baseName = file.name.replace(/\.pdf$/i, "") || "output";

  progressBar.style.display = "block";
  progressBar.value = 0;

  const results = [];

  for (let p = 1; p <= pageCount; p++) {
    const page = await pdf.getPage(p);
    const viewport = page.getViewport({ scale });

    const canvas = document.createElement("canvas");
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    await page.render({
      canvasContext: canvas.getContext("2d"),
      viewport
    }).promise;

    const blob = await canvasToBlob(canvas, quality);
    const url = URL.createObjectURL(blob);
    const filename = `page-${String(p).padStart(3, "0")}.jpg`;

    results.push({ url, blob, filename });

    progressBar.value = (p / pageCount) * 100;
  }

  // Thumbnails (always clickable)
  results.forEach(r => {
    const card = document.createElement("a");
    card.href = r.url;
    card.download = r.filename;
    card.className = "thumb-card";

    const img = document.createElement("img");
    img.src = r.url;
    img.className = "thumb-img";

    const name = document.createElement("div");
    name.className = "thumb-name";
    name.textContent = r.filename;

    card.appendChild(img);
    card.appendChild(name);
    outputsDiv.appendChild(card);
  });

  // ZIP if many pages
  if (useZip) {
    results.forEach(r => zip.file(r.filename, r.blob));
    const zipBlob = await zip.generateAsync({ type: "blob" });
    const zipUrl = URL.createObjectURL(zipBlob);
    zipDownload.href = zipUrl;
    zipDownload.download = `${baseName}-pages.zip`;
    zipDownload.style.display = "block";
  }

  progressBar.style.display = "none";
});
</script>

</body>
</html>
